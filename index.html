
// Khi Screen kh·ªüi ƒë·ªông
when Screen1.Initialize
  set WebView1.WebViewString to <!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz M√¥i Tr∆∞·ªùng</title>
    <style>
        /* RESET & BASIC STYLES */
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: linear-gradient(to bottom, #e0f7e9, #c8e6c9);
            color: #2e7d32;
            padding: 10px;
            font-size: 16px;
            min-height: 100vh;
        }
        
        /* CONTAINER */
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* HEADER */
        .header {
            background: #2e7d32;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* SCORE DISPLAY */
        .score-container {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        }
        
        .score-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .score-value {
            font-size: 36px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        /* QUIZ AREA */
        .quiz-area {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* QUESTION CARD */
        .question-card {
            background: #f8fffa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #4caf50;
        }
        
        .question-number {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .question-text {
            font-weight: bold;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        /* OPTIONS */
        .option {
            display: block;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }
        
        .option:hover {
            background: #f1f8e9;
        }
        
        .option.selected {
            background: #e8f5e9;
            border-color: #4caf50;
            font-weight: bold;
        }
        
        .option-label {
            display: inline-block;
            width: 25px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        /* BUTTONS */
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .btn-submit {
            background: linear-gradient(to right, #4caf50, #2e7d32);
            color: white;
        }
        
        .btn-submit:active {
            background: linear-gradient(to right, #388e3c, #1b5e20);
            transform: scale(0.98);
        }
        
        .btn-reset {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }
        
        .btn-reset:active {
            background: #e0e0e0;
            transform: scale(0.98);
        }
        
        /* PROGRESS BAR */
        .progress-container {
            margin-top: 15px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .progress-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #2e7d32);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* RESPONSIVE */
        @media (max-width: 480px) {
            .header h1 { font-size: 20px; }
            .score-value { font-size: 32px; }
            .btn { padding: 14px; font-size: 15px; }
            .option { padding: 10px 12px; }
        }
        
        /* FEEDBACK COLORS */
        .correct { border-left-color: #4caf50 !important; background: #e8f5e9 !important; }
        .wrong { border-left-color: #f44336 !important; background: #ffebee !important; }
        .not-answered { border-left-color: #ff9800 !important; background: #fff8e1 !important; }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üå± QUIZ M√îI TR∆Ø·ªúNG</h1>
            <p>Ki·ªÉm tra ki·∫øn th·ª©c b·∫£o v·ªá m√¥i tr∆∞·ªùng</p>
        </div>
        
        <!-- SCORE DISPLAY -->
        <div class="score-container">
            <div class="score-label">T·ªîNG ƒêI·ªÇM C·ª¶A B·∫†N</div>
            <div class="score-value" id="totalScore">0</div>
        </div>
        
        <!-- QUIZ AREA -->
        <div class="quiz-area" id="quizArea">
            <div style="text-align:center; padding:50px 20px; color:#666;">
                <div style="font-size:48px; margin-bottom:20px;">üåç</div>
                <p>ƒêang t·∫£i c√¢u h·ªèi...</p>
            </div>
        </div>
        
        <!-- PROGRESS -->
        <div class="progress-container">
            <div class="progress-label">
                <span id="answeredCount">0</span>/<span id="totalQuestions">10</span> c√¢u ƒë√£ tr·∫£ l·ªùi
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <!-- BUTTONS -->
        <div class="buttons">
            <button class="btn btn-submit" onclick="submitQuiz()">N·ªòP B√ÄI</button>
            <button class="btn btn-reset" onclick="resetScore()">RESET ƒêI·ªÇM</button>
        </div>
    </div>

    <script>
        // ====================
        // DATABASE - QUESTION BANK
        // ====================
        var questionBank = [
            {
                id: 1,
                question: "Gi·∫•y v·ª•n thu·ªôc nh√≥m r√°c n√†o?",
                options: ["T√°i ch·∫ø", "V√¥ c∆°", "H·ªØu c∆°", "R√°c ƒë·ªôc h·∫°i"],
                correct: 0,
                explanation: "Gi·∫•y v·ª•n c√≥ th·ªÉ t√°i ch·∫ø th√†nh gi·∫•y m·ªõi."
            },
            {
                id: 2,
                question: "Pin c≈© h·ªèng n√™n x·ª≠ l√Ω th·∫ø n√†o?",
                options: ["V·ª©t v√†o th√πng r√°c h·ªØu c∆°", "ƒê·ªët ƒëi", "Gom l·∫°i ƒë∆∞a ƒë·∫øn ƒëi·ªÉm thu gom ri√™ng", "V·ª©t xu·ªëng c·ªëng"],
                correct: 2,
                explanation: "Pin ch·ª©a ch·∫•t ƒë·ªôc h·∫°i, c·∫ßn thu gom ri√™ng."
            },
            {
                id: 3,
                question: "Ng√†y M√¥i tr∆∞·ªùng Th·∫ø gi·ªõi l√† ng√†y n√†o?",
                options: ["5/5", "5/6", "1/6", "2/9"],
                correct: 1,
                explanation: "Ng√†y 5/6 h√†ng nƒÉm l√† Ng√†y M√¥i tr∆∞·ªùng Th·∫ø gi·ªõi."
            },
            {
                id: 4,
                question: "Lo·∫°i r√°c n√†o c√≥ th·ªÉ ph√¢n h·ªßy sinh h·ªçc?",
                options: ["T√∫i nilon", "V·ªè h·ªôp s·ªØa", "Rau c·ªß qu·∫£ th·ª´a", "Chai nh·ª±a"],
                correct: 2,
                explanation: "Rau c·ªß qu·∫£ th·ª´a l√† r√°c h·ªØu c∆°, c√≥ th·ªÉ ph√¢n h·ªßy."
            },
            {
                id: 5,
                question: "H√†nh ƒë·ªông n√†o gi√∫p ti·∫øt ki·ªám ƒëi·ªán?",
                options: ["B·∫≠t ƒëi·ªÅu h√≤a 24/7", "T·∫Øt ƒë√®n khi kh√¥ng d√πng", "D√πng b√≥ng ƒë√®n s·ª£i ƒë·ªët", "M·ªü t·ªß l·∫°nh th∆∞·ªùng xuy√™n"],
                correct: 1,
                explanation: "T·∫Øt ƒë√®n khi kh√¥ng s·ª≠ d·ª•ng gi√∫p ti·∫øt ki·ªám ƒëi·ªán."
            },
            {
                id: 6,
                question: "N√™n l√†m g√¨ v·ªõi qu·∫ßn √°o c≈©?",
                options: ["V·ª©t v√†o th√πng r√°c", "ƒê·ªët b·ªè", "T·∫∑ng ho·∫∑c t√°i s·ª≠ d·ª•ng", "V·ª©t xu·ªëng s√¥ng"],
                correct: 2,
                explanation: "T·∫∑ng ho·∫∑c t√°i s·ª≠ d·ª•ng gi·∫£m r√°c th·∫£i."
            },
            {
                id: 7,
                question: "Ph∆∞∆°ng ti·ªán n√†o th√¢n thi·ªán m√¥i tr∆∞·ªùng nh·∫•t?",
                options: ["Xe m√°y", "√î t√¥ con", "Xe ƒë·∫°p", "Xe bu√Ωt"],
                correct: 2,
                explanation: "Xe ƒë·∫°p kh√¥ng th·∫£i kh√≠ ƒë·ªôc, t·ªët cho s·ª©c kh·ªèe."
            },
            {
                id: 8,
                question: "Th√πng r√°c m√†u xanh th∆∞·ªùng ƒë·ª±ng r√°c g√¨?",
                options: ["R√°c h·ªØu c∆°", "R√°c t√°i ch·∫ø", "R√°c v√¥ c∆°", "R√°c ƒë·ªôc h·∫°i"],
                correct: 1,
                explanation: "Th√πng xanh th∆∞·ªùng d√πng cho r√°c t√°i ch·∫ø."
            },
            {
                id: 9,
                question: "NƒÉng l∆∞·ª£ng n√†o l√† t√°i t·∫°o?",
                options: ["Than ƒë√°", "D·∫ßu m·ªè", "Kh√≠ ƒë·ªët", "NƒÉng l∆∞·ª£ng gi√≥"],
                correct: 3,
                explanation: "NƒÉng l∆∞·ª£ng gi√≥ l√† nƒÉng l∆∞·ª£ng t√°i t·∫°o."
            },
            {
                id: 10,
                question: "C√¢y xanh c√≥ t√°c d·ª•ng g√¨?",
                options: ["H·∫•p th·ª• CO2, th·∫£i O2", "H·∫•p th·ª• O2, th·∫£i CO2", "TƒÉng nhi·ªát ƒë·ªô", "G√¢y √¥ nhi·ªÖm"],
                correct: 0,
                explanation: "C√¢y xanh quang h·ª£p: h·∫•p th·ª• CO2, th·∫£i O2."
            }
        ];

        // ====================
        // GLOBAL VARIABLES
        // ====================
        var totalScore = 0;
        var currentQuiz = [];
        var userAnswers = [];
        var quizInProgress = true;

        // ====================
        // INITIALIZATION
        // ====================
        function init() {
            console.log("Quiz ƒëang kh·ªüi t·∫°o...");
            
            // Load score from localStorage
            var savedScore = localStorage.getItem('envQuizScore');
            if (savedScore !== null && savedScore !== "") {
                totalScore = parseInt(savedScore);
            }
            
            // Update score display
            document.getElementById('totalScore').textContent = totalScore;
            
            // Start new quiz
            startNewQuiz();
            
            console.log("Quiz ƒë√£ s·∫µn s√†ng!");
        }

        // ====================
        // START NEW QUIZ
        // ====================
        function startNewQuiz() {
            quizInProgress = true;
            userAnswers = [];
            
            // Shuffle and select questions
            currentQuiz = shuffleArray(questionBank).slice(0, 5);
            
            // Update total questions display
            document.getElementById('totalQuestions').textContent = currentQuiz.length;
            
            // Generate HTML for questions
            var html = '';
            
            for (var i = 0; i < currentQuiz.length; i++) {
                var q = currentQuiz[i];
                html += '<div class="question-card" id="q' + i + '">';
                html += '<div class="question-number">C√¢u ' + (i + 1) + '/5</div>';
                html += '<div class="question-text">' + q.question + '</div>';
                
                for (var j = 0; j < q.options.length; j++) {
                    var optionLetter = String.fromCharCode(65 + j);
                    html += '<div class="option" onclick="selectOption(' + i + ', ' + j + ')">';
                    html += '<span class="option-label">' + optionLetter + '.</span> ';
                    html += q.options[j];
                    html += '</div>';
                }
                
                html += '</div>';
            }
            
            document.getElementById('quizArea').innerHTML = html;
            updateProgress();
        }

        // ====================
        // UTILITY FUNCTIONS
        // ====================
        function shuffleArray(array) {
            var newArray = array.slice();
            for (var i = newArray.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = newArray[i];
                newArray[i] = newArray[j];
                newArray[j] = temp;
            }
            return newArray;
        }

        function selectOption(questionIndex, optionIndex) {
            if (!quizInProgress) return;
            
            userAnswers[questionIndex] = optionIndex;
            
            // Remove selected class from all options in this question
            var questionDiv = document.getElementById('q' + questionIndex);
            var options = questionDiv.getElementsByClassName('option');
            for (var i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
            }
            
            // Add selected class to clicked option
            options[optionIndex].classList.add('selected');
            
            updateProgress();
        }

        function updateProgress() {
            var answered = 0;
            for (var i = 0; i < currentQuiz.length; i++) {
                if (userAnswers[i] !== undefined) answered++;
            }
            
            document.getElementById('answeredCount').textContent = answered;
            
            var progressPercent = (answered / currentQuiz.length) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
        }

        // ====================
        // SUBMIT QUIZ
        // ====================
        function submitQuiz() {
            if (!quizInProgress) {
                startNewQuiz();
                return;
            }
            
            var score = 0;
            var allAnswered = true;
            
            // Check if all questions are answered
            for (var i = 0; i < currentQuiz.length; i++) {
                if (userAnswers[i] === undefined) {
                    allAnswered = false;
                    break;
                }
            }
            
            if (!allAnswered) {
                alert("‚ö†Ô∏è Vui l√≤ng tr·∫£ l·ªùi t·∫•t c·∫£ " + currentQuiz.length + " c√¢u h·ªèi!");
                return;
            }
            
            // Calculate score and show feedback
            for (var i = 0; i < currentQuiz.length; i++) {
                var questionDiv = document.getElementById('q' + i);
                var correctIndex = currentQuiz[i].correct;
                
                if (userAnswers[i] === correctIndex) {
                    score += 20; // 20 ƒëi·ªÉm m·ªói c√¢u ƒë√∫ng
                    questionDiv.classList.add('correct');
                } else {
                    questionDiv.classList.add('wrong');
                }
            }
            
            // Update total score
            totalScore += score;
            document.getElementById('totalScore').textContent = totalScore;
            localStorage.setItem('envQuizScore', totalScore);
            
            quizInProgress = false;
            
            // Show result
            var resultMessage = "üéâ K·∫æT QU·∫¢ üéâ\n\n";
            resultMessage += "B·∫°n ƒë·∫°t: " + score + "/100 ƒëi·ªÉm\n";
            resultMessage += "T·ªïng ƒëi·ªÉm: " + totalScore + "\n\n";
            resultMessage += "Ch·∫°m N·ªòP B√ÄI l·∫ßn n·ªØa ƒë·ªÉ l√†m quiz m·ªõi!";
            
            alert(resultMessage);
            
            // Change button text
            document.querySelector('.btn-submit').textContent = "L√ÄM QUIZ M·ªöI";
        }

        // ====================
        // RESET SCORE
        // ====================
        function resetScore() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô ƒëi·ªÉm s·ªë?\nƒêi·ªÉm hi·ªán t·∫°i: " + totalScore)) {
                totalScore = 0;
                document.getElementById('totalScore').textContent = 0;
                localStorage.removeItem('envQuizScore');
                alert("‚úÖ ƒêi·ªÉm s·ªë ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t l·∫°i v·ªÅ 0!");
                startNewQuiz();
            }
        }

        // ====================
        // COMMUNICATION WITH APP INVENTOR
        // ====================
        // Function to send score back to App Inventor
        function sendScoreToApp() {
            try {
                // This will work if App Inventor sets up JavaScript interface
                if (typeof Android !== 'undefined' && Android.receiveScore) {
                    Android.receiveScore(totalScore);
                }
            } catch (e) {
                console.log("Kh√¥ng th·ªÉ g·ª≠i ƒëi·ªÉm ƒë·∫øn App Inventor: " + e);
            }
        }

        // ====================
        // START THE QUIZ
        // ====================
        // Wait for DOM to load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
